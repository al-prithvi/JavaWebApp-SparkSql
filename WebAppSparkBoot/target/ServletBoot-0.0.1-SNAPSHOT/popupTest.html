    <!doctype html>
    <html>
    <head>
    <!--link rel="stylesheet" type="text/css" media="all" href="css/reset.css" /> <!-- reset css -->
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<link href="grid.css" rel="stylesheet">
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">
	
    <style>
        window{width:300px; height:150px; }
        body{ background-color: ivory;}
        #canvas{border:1px solid red; margin:0 auto; }
    </style>
	<script src=Chart.bundle.js></script>
    <script>
	//beginning of jscript
	var data;
    $(function(){
		
		//OK ------
	ctx = document.getElementById("myChart");
	ctx.style.backgroundColor = 'white';
	/*lab = window.opener.lab;//['DMA','someother','thing'];
	l= window.opener.l;//[12,-5,-3];
	key_opt = window.opener.key_opt;
	agg_opt = window.opener.agg_opt;
	col_opt = window.opener.col_opt; */
	lab = window.localStorage.getItem("lab");
	l = window.localStorage.getItem("l");
	key_opt = window.localStorage.getItem("key_opt");
	agg_opt = window.localStorage.getItem("agg_opt");
	clickedId = window.localStorage.getItem("clickedId");
	data = window.localStorage.getItem("data");
	
	console.log(lab);
	console.log(typeof l);
	console.log(typeof key_opt);
	console.log(agg_opt);
	console.log(clickedId);
	lab = lab.split(/\s*,\s*/);
	l = l.split(/\s*,\s*/);

	myChart = new Chart(ctx, {
	    type: 'bar',
	    data: {
	        labels: lab,
	        datasets: [{
	            label: agg_opt+'('+clickedId+')',
	            data: l,
	            backgroundColor: "rgba(14,72,100,1)",
				strokeColor: "brown",
	            borderWidth: 1
	        }]
	    },
	    options: {
			title : {
				display: true,
				text: agg_opt+'('+clickedId+') for each '+key_opt
			},
	        scales: {
	            yAxes: [{
	                ticks: {
	                    beginAtZero:true
	                },
	                scaleLabel: {
	                	display:true,
	                	labelString: agg_opt+'('+clickedId+')'
	                }
	            }],
				xAxes: [{
					scaleLabel: {
						display:true,
						labelString: key_opt
					}
				}
				]
	        }
	    }
	});
		

    }); 
	

    function downloadCsv(){
    	console.log('something');
    	//var json_pre = '[{"Id":1,"UserName":"Sam Smith"},{"Id":2,"UserName":"Fred Frankly"},{"Id":1,"UserName":"Zachary Zupers"}]';
        //var json = $.parseJSON(json_pre);
    	data = JSON.parse(data);
        var csv = JSON2CSV(data);
        var downloadLink = document.createElement("a");
        var blob = new Blob(["\ufeff", csv]);
        var url = URL.createObjectURL(blob);
        downloadLink.href = url;
        downloadLink.download = "data.csv";

        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);	
    }


    function JSON2CSV(objArray) {
        var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;
        var str = '';
        var line = '';

        if ($("#labels").is(':checked')) {
            var head = array[0];
            if ($("#quote").is(':checked')) {
                for (var index in array[0]) {
                    var value = index + "";
                    line += '"' + value.replace(/"/g, '""') + '",';
                }
            } else {
                for (var index in array[0]) {
                    line += index + ',';
                }
            }

            line = line.slice(0, -1);
            str += line + '\r\n';
        }

        for (var i = 0; i < array.length; i++) {
            var line = '';

            if ($("#quote").is(':checked')) {
                for (var index in array[i]) {
                    var value = array[i][index] + "";
                    line += '"' + value.replace(/"/g, '""') + '",';
                }
            } else {
                for (var index in array[i]) {
                    line += array[i][index] + ',';
                }
            }

            line = line.slice(0, -1);
            str += line + '\r\n';
        }
        return str;
    }
	
	
	
	// end $(function(){});
    </script>
	
    </head>
    <body>
    	
	    <div class="container graphcanvas">
        <div class="row">
          <div class="col-md-12">
			<canvas id="myChart"></canvas>
			</div>
		</div>
		</div>
		<div class="container dwn_pop">
	      <div class="row">
		   <div class="col-md-12 text-center"> 
				<button class="btn btn-success" type="button" onclick="downloadCsv()" >Download</button> 
		   </div>
		   </div> 
	  </div>
	  
	  
    </body>
    </html>